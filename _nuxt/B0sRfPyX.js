import{_ as ee}from"./BNcyMyJ5.js";import{_ as oe}from"./Bs5omffR.js";import{_ as se}from"./BOQcnD3M.js";import{_ as ne}from"./CqKiwvmE.js";import{_ as te}from"./Cf6iOLNp.js";import{c as ae,_ as le}from"./D8Q0hYy_.js";import{f as R,r as f,B as N,E as Y,v as H,o as v,k as I,w as n,d as u,j as e,b as s,c as O,F as T,q as W,t as B,a as y,l as j,A as ie,g as re,G as ue,h as _e,m as ce,H as me,D as de,i as pe,I as fe}from"./i5TJQzka.js";import{_ as ve}from"./Cg8_t5hT.js";import{b as ge,_ as be}from"./BBr3gd9W.js";import{_ as J}from"./Ku9elUC7.js";import{u as ye}from"./B4ZmTmuj.js";import{u as he}from"./BnCecOc4.js";import{_ as Ve}from"./CYbcH_7w.js";import{_ as we,a as ke,c as xe,b as Pe}from"./BPtKBgaY.js";import{_ as Se}from"./Bgkr3Prp.js";import{c as Oe}from"./DCS7RcIW.js";import"./BbGZh-rT.js";import"./BarbQds6.js";import"./CqO_RI43.js";var h=(_=>(_.iOS="ios",_.iPad="ipados",_.Mac="macos",_.Vision="visionos",_.TV="tvos",_))(h||{});const Ae={[h.Mac]:"Mac",[h.TV]:"Apple TV",[h.Vision]:"Apple Vision",[h.iOS]:"iPhone",[h.iPad]:"iPad"};function Ue(_){return Ae[_]}const $e={class:"flex flex-col gap-1.5"},Ce=R({__name:"v-modal-binary-package-metadata-copy",props:{id:{},scope:{}},emits:["selected"],setup(_,{expose:V,emit:A}){const U=_,E=A,w=f(),g=f(!1);V({show:()=>{var c;return(c=w.value)==null?void 0:c.show()},hide:()=>{var c;return(c=w.value)==null?void 0:c.hide()}});const k=f(!1),t=f([]),$=N(()=>t.value.filter(c=>c.id!==U.id));Y(()=>{g.value&&C()});async function C(){k.value=!0;try{t.value=await H({scope:U.scope})}finally{k.value=!1}}function x(c){var r;E("selected",c),(r=w.value)==null||r.hide()}return(c,r)=>{const P=Ve,d=we,M=ke,m=xe,S=J,L=Pe;return v(),I(e(Se),{ref_key:"modal",ref:w,modelValue:e(g),"onUpdate:modelValue":r[0]||(r[0]=a=>j(g)?g.value=a:null)},{header:n(()=>[u(" Fill metadata from another IPA package ")]),default:n(()=>[e(k)?(v(),I(P,{key:0,class:"border-blue-700/30 border-l-blue-700",size:"4rem"})):(v(),I(L,{key:1},{head:n(()=>[s(M,null,{default:n(()=>[s(d,null,{default:n(()=>[u("Version")]),_:1}),s(d,null,{default:n(()=>[u("Status")]),_:1}),s(d,null,{default:n(()=>[u("Is in store")]),_:1}),s(d)]),_:1})]),empty:n(()=>[u("No IPA packages with the same app identifier were found")]),body:n(()=>[(v(!0),O(T,null,W(e($),a=>(v(),I(M,{key:a.id},{default:n(()=>[s(m,null,{default:n(()=>[u(B(a.bundle_version),1)]),_:2},1024),s(m,null,{default:n(()=>[u(B(a.status_translated),1)]),_:2},1024),s(m,null,{default:n(()=>[u(B(a.is_assigned?"Yes":"No"),1)]),_:2},1024),s(m,null,{default:n(()=>[y("div",$e,[s(S,{variant:"primary",onClick:o=>x(a)},{default:n(()=>[u(" Select ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["modelValue"])}}});var Me=1,Fe=4;function Ie(_){return ge(_,Me|Fe)}const Ne={class:"flex flex-col gap-5"},Be={class:"grid auto-cols-fr grid-flow-col gap-5"},Ee={key:0,class:"mt-5 flex h-96 gap-5 overflow-auto"},Le=["onClick"],De=["src"],Te={class:"flex gap-2"},io=R({__name:"[id]",async setup(_){let V,A;const{title:U,backPath:E}=ye("metadata"),w=ie(),g=Number(w.params.id),[k]=([V,A]=re(()=>H({id:g})),V=await V,A(),V),t=ue({id:g,min_ios_version:"",min_ipados_version:"",min_tvos_version:"",min_macos_version:"",min_watchos_version:"",min_visionos_version:"",description:"",whatsnew:"",screenshots_uris_by_os_type:{ios:[],ipados:[],macos:[],tvos:[],universal:[],visionos:[]}}),$=f();function C(a,{filterUniqueFields:o}={}){if(!a)return;const b=["id"];for(const p in t){const i=p;if(!(!(i in a)||o&&b.includes(i))){if(t[i]&&a[i]===null)return;t[i]=a[i]}}}C(k);const x=N(()=>["universal",...Object.values(h).filter(o=>t[`min_${o}_version`])]),c=N(()=>x.value.map(a=>({label:Ue(a)||Oe(a),value:a}))),r=f(x.value[0]);Y(()=>{x.value.includes(r.value)||(r.value=x.value[0])});const P=f(!1),d=f([]),M=N(()=>d.value.length?d.value.reduce((a,o)=>a+o)/d.value.length:0),m=f([]);_e(m,async()=>{if(!m.value.length)return;const a=r.value;P.value=!0,d.value=Array(m.value.length).fill(0);try{const o=m.value.map((p,i)=>he({type:"screenshot",file:p},{onUploadProgress:D=>{d.value[i]=ae(D)}})),b=await Promise.all(o);t.screenshots_uris_by_os_type[a].push(...b)}finally{P.value=!1,d.value=[]}});const S=f(!1);async function L(){S.value=!0;try{const a=Ie(t);for(const b of Object.values(h))a[`min_${b}_version`]||(a.screenshots_uris_by_os_type[b]=[]);await me(a),de("/apps/binary-packages");const{notifySuccess:o}=pe();o("IPA package metadata was saved")}finally{S.value=!1}}return(a,o)=>{var z;const b=ee,p=oe,i=se,D=ne,K=te,Q=le,X=fe,Z=ve,q=be,G=J;return v(),O(T,null,[y("div",null,[s(b,{"back-to":e(E)},{default:n(()=>[u(B(e(U)),1)]),_:1},8,["back-to"]),y("form",Ne,[y("div",Be,[s(i,{label:"Min. iOS version"},{default:n(()=>[s(p,{modelValue:e(t).min_ios_version,"onUpdate:modelValue":o[0]||(o[0]=l=>e(t).min_ios_version=l)},null,8,["modelValue"])]),_:1}),s(i,{label:"Min. iPadOS version"},{default:n(()=>[s(p,{modelValue:e(t).min_ipados_version,"onUpdate:modelValue":o[1]||(o[1]=l=>e(t).min_ipados_version=l)},null,8,["modelValue"])]),_:1}),s(i,{label:"Min. watchOS version"},{default:n(()=>[s(p,{modelValue:e(t).min_watchos_version,"onUpdate:modelValue":o[2]||(o[2]=l=>e(t).min_watchos_version=l)},null,8,["modelValue"])]),_:1}),s(i,{label:"Min. macOS version"},{default:n(()=>[s(p,{modelValue:e(t).min_macos_version,"onUpdate:modelValue":o[3]||(o[3]=l=>e(t).min_macos_version=l)},null,8,["modelValue"])]),_:1}),s(i,{label:"Min. visionOS version"},{default:n(()=>[s(p,{modelValue:e(t).min_visionos_version,"onUpdate:modelValue":o[4]||(o[4]=l=>e(t).min_visionos_version=l)},null,8,["modelValue"])]),_:1}),s(i,{label:"Min. tvOS version"},{default:n(()=>[s(p,{modelValue:e(t).min_tvos_version,"onUpdate:modelValue":o[5]||(o[5]=l=>e(t).min_tvos_version=l)},null,8,["modelValue"])]),_:1})]),y("div",null,[s(D,{class:"mb-3"},{default:n(()=>[u("Screenshots")]),_:1}),s(K,{modelValue:e(r),"onUpdate:modelValue":o[6]||(o[6]=l=>j(r)?r.value=l:null),class:"mb-4",options:e(c)},null,8,["modelValue","options"]),s(Q,{modelValue:e(m),"onUpdate:modelValue":o[7]||(o[7]=l=>j(m)?m.value=l:null),loading:e(P),progress:e(M),accept:".png",multiple:""},{default:n(()=>[u(" Choose screenshots or drag them here ")]),_:1},8,["modelValue","loading","progress"]),(z=e(t).screenshots_uris_by_os_type[e(r)])!=null&&z.length?(v(),O("div",Ee,[(v(!0),O(T,null,W(e(t).screenshots_uris_by_os_type[e(r)],(l,F)=>(v(),O("div",{key:l,class:"relative h-full shrink-0"},[y("button",{class:"absolute right-0 top-0 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 leading-none text-white",onClick:je=>e(t).screenshots_uris_by_os_type[e(r)].splice(F,1)},[s(X,{name:"tabler:x"})],8,Le),y("img",{class:"h-full",src:l},null,8,De)]))),128))])):ce("",!0)]),s(Z,null,{default:n(()=>[u("App description and what's new notes support markdown")]),_:1}),s(i,{label:"Description"},{default:n(()=>[s(q,{modelValue:e(t).description,"onUpdate:modelValue":o[8]||(o[8]=l=>e(t).description=l),rows:3},null,8,["modelValue"])]),_:1}),s(i,{label:"What's new"},{default:n(()=>[s(q,{modelValue:e(t).whatsnew,"onUpdate:modelValue":o[9]||(o[9]=l=>e(t).whatsnew=l),rows:3},null,8,["modelValue"])]),_:1}),y("div",Te,[s(G,{variant:"primary",loading:e(S),onClick:L},{default:n(()=>[u(" Save ")]),_:1},8,["loading"]),s(G,{onClick:o[10]||(o[10]=l=>{var F;return(F=e($))==null?void 0:F.show()})},{default:n(()=>[u(" Fill from another IPA package")]),_:1})])])]),s(e(Ce),{id:e(g),ref_key:"copyModal",ref:$,scope:e(k).app_identifier,onSelected:o[11]||(o[11]=l=>C(l,{filterUniqueFields:!0}))},null,8,["id","scope"])],64)}}});export{io as default};
//# sourceMappingURL=B0sRfPyX.js.map
