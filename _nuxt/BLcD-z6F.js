import{_ as se}from"./BOxUQ7au.js";import{_ as ne}from"./CNuvrcr4.js";import{a as te}from"./z0HrQUi6.js";import{_ as ae}from"./aC7M5Q-O.js";import{_ as le}from"./ClYt1EcI.js";import{c as ie,_ as re}from"./DtiMHTAY.js";import{f as H,r as f,i as E,G as J,v as W,o as v,k as N,w as n,d as r,j as e,b as o,c as O,F as T,q as K,t as U,a as y,l as j,C as ue,g as _e,H as de,h as ce,I as z,m as me,J as pe,E as fe,y as ve,x as ge}from"./CQGbWGcf.js";import{_ as be}from"./uRMHzGBs.js";import{b as ye,_ as Ve}from"./DR9XfiVK.js";import{_ as Q}from"./DwB0_ZuQ.js";import{u as he}from"./BtYaOVdA.js";import{u as we}from"./C_bPjkEo.js";import{_ as ke}from"./BZpUhvHW.js";import{_ as xe,a as Se,c as Pe,b as Oe}from"./D5k3EH1I.js";import{_ as Ue}from"./CNMGvoUf.js";import{c as $e}from"./DCS7RcIW.js";import"./DV-o3S7m.js";import"./BarbQds6.js";import"./CqO_RI43.js";var V=(_=>(_.iOS="ios",_.iPad="ipados",_.Mac="macos",_.Vision="visionos",_.TV="tvos",_))(V||{});const Ae={[V.Mac]:"Mac",[V.TV]:"Apple TV",[V.Vision]:"Apple Vision",[V.iOS]:"iPhone",[V.iPad]:"iPad"};function Me(_){return Ae[_]}const Ce={class:"flex flex-col gap-1.5"},Fe=H({__name:"v-modal-binary-package-metadata-copy",props:{id:{},scope:{}},emits:["selected"],setup(_,{expose:h,emit:$}){const A=_,L=$,w=f(),g=f(!1);h({show:()=>{var c;return(c=w.value)==null?void 0:c.show()},hide:()=>{var c;return(c=w.value)==null?void 0:c.hide()}});const k=f(!1),t=f([]),M=E(()=>t.value.filter(c=>c.id!==A.id));J(()=>{g.value&&C()});async function C(){k.value=!0;try{t.value=await W({scope:A.scope})}finally{k.value=!1}}function x(c){var u;L("selected",c),(u=w.value)==null||u.hide()}return(c,u)=>{const S=ke,m=xe,F=Se,d=Pe,P=Q,B=Oe;return v(),N(e(Ue),{ref_key:"modal",ref:w,modelValue:e(g),"onUpdate:modelValue":u[0]||(u[0]=a=>j(g)?g.value=a:null)},{header:n(()=>[r(" Fill metadata from another IPA package ")]),default:n(()=>[e(k)?(v(),N(S,{key:0,class:"border-blue-700/30 border-l-blue-700",size:"4rem"})):(v(),N(B,{key:1},{head:n(()=>[o(F,null,{default:n(()=>[o(m,null,{default:n(()=>[r("Version")]),_:1}),o(m,null,{default:n(()=>[r("Status")]),_:1}),o(m,null,{default:n(()=>[r("Is assigned")]),_:1}),o(m,null,{default:n(()=>[r("Is actual")]),_:1}),o(m)]),_:1})]),empty:n(()=>[r("No IPA packages were found")]),body:n(()=>[(v(!0),O(T,null,K(e(M),a=>(v(),N(F,{key:a.id},{default:n(()=>[o(d,null,{default:n(()=>[r(U(a.bundle_version),1)]),_:2},1024),o(d,null,{default:n(()=>[r(U(a.status_translated),1)]),_:2},1024),o(d,null,{default:n(()=>[r(U(a.is_assigned?"Yes":"No"),1)]),_:2},1024),o(d,null,{default:n(()=>[r(U(a.is_in_store?"Yes":"No"),1)]),_:2},1024),o(d,null,{default:n(()=>[y("div",Ce,[o(P,{variant:"primary",onClick:s=>x(a)},{default:n(()=>[r(" Select ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["modelValue"])}}});var Ie=1,Ne=4;function R(_){return ye(_,Ie|Ne)}const Ee={class:"grid auto-cols-fr grid-flow-col gap-5"},Le={key:0,class:"mt-5 flex h-96 gap-5 overflow-auto"},Be=["onClick"],De=["src"],Te={class:"flex gap-2"},io=H({__name:"[id]",async setup(_){let h,$;const{title:A,backPath:L}=he("metadata"),w=ue(),g=Number(w.params.id),[k]=([h,$]=_e(()=>W({id:g})),h=await h,$(),h),t=de({id:g,min_ios_version:"",min_ipados_version:"",min_tvos_version:"",min_macos_version:"",min_watchos_version:"",min_visionos_version:"",description:"",whatsnew:"",screenshots_uris_by_os_type:{ios:[],ipados:[],macos:[],tvos:[],universal:[],visionos:[]}}),M=f();function C(a,{filterUniqueFields:s}={}){if(!a)return;const b=["id"];for(const p in t){const i=p;!(i in a)||s&&b.includes(i)||t[i]&&a[i]===null||(t[i]=R(a[i]))}}C(k);const x=E(()=>["universal",...Object.values(V).filter(s=>t[`min_${s}_version`])]),c=E(()=>x.value.map(a=>({label:Me(a)||$e(a),value:a}))),u=f(x.value[0]);J(()=>{x.value.includes(u.value)||(u.value=x.value[0])});const S=f(!1),m=f([]),F=E(()=>m.value.length?m.value.reduce((a,s)=>a+s)/m.value.length:0),d=f([]);ce(d,async()=>{if(!d.value.length)return;const a=u.value;S.value=!0,m.value=Array(d.value.length).fill(0);try{const s=d.value.map((p,i)=>we({type:"screenshot",file:p},{onUploadProgress:D=>{m.value[i]=ie(D)}})),b=await Promise.all(s);t.screenshots_uris_by_os_type[a].push(...b)}finally{S.value=!1,m.value=[]}});const P=f(!1);async function B(){P.value=!0;try{const a=R(t);for(const b of Object.values(V))a[`min_${b}_version`]||(a.screenshots_uris_by_os_type[b]=[]);await pe(a),fe("/apps/binary-packages");const{notifySuccess:s}=ve();s("IPA package metadata was saved")}finally{P.value=!1}}return(a,s)=>{var Y;const b=se,p=ne,i=te,D=ae,X=le,Z=re,ee=ge,oe=be,q=Ve,G=Q;return v(),O(T,null,[y("div",null,[o(b,{"default-back-to":e(L)},{default:n(()=>[r(U(e(A)),1)]),_:1},8,["default-back-to"]),y("form",{class:"flex flex-col gap-5",onSubmit:z(B,["prevent"])},[y("div",Ee,[o(i,{label:"Min. iOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_ios_version,"onUpdate:modelValue":s[0]||(s[0]=l=>e(t).min_ios_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. iPadOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_ipados_version,"onUpdate:modelValue":s[1]||(s[1]=l=>e(t).min_ipados_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. watchOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_watchos_version,"onUpdate:modelValue":s[2]||(s[2]=l=>e(t).min_watchos_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. macOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_macos_version,"onUpdate:modelValue":s[3]||(s[3]=l=>e(t).min_macos_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. visionOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_visionos_version,"onUpdate:modelValue":s[4]||(s[4]=l=>e(t).min_visionos_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. tvOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_tvos_version,"onUpdate:modelValue":s[5]||(s[5]=l=>e(t).min_tvos_version=l)},null,8,["modelValue"])]),_:1})]),y("div",null,[o(D,{class:"mb-3"},{default:n(()=>[r("Screenshots")]),_:1}),o(X,{modelValue:e(u),"onUpdate:modelValue":s[6]||(s[6]=l=>j(u)?u.value=l:null),class:"mb-4",options:e(c)},null,8,["modelValue","options"]),o(Z,{modelValue:e(d),"onUpdate:modelValue":s[7]||(s[7]=l=>j(d)?d.value=l:null),loading:e(S),progress:e(F),extensions:["png"],multiple:"","notification-id":"edit_official_ipa_metadata"},{default:n(()=>[r(" Choose screenshots or drag them here ")]),_:1},8,["modelValue","loading","progress"]),(Y=e(t).screenshots_uris_by_os_type[e(u)])!=null&&Y.length?(v(),O("div",Le,[(v(!0),O(T,null,K(e(t).screenshots_uris_by_os_type[e(u)],(l,I)=>(v(),O("div",{key:l,class:"relative h-full shrink-0"},[y("button",{class:"absolute right-0 top-0 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 leading-none text-white",onClick:je=>e(t).screenshots_uris_by_os_type[e(u)].splice(I,1)},[o(ee,{name:"tabler:x"})],8,Be),y("img",{class:"h-full",src:l},null,8,De)]))),128))])):me("",!0)]),o(oe,null,{default:n(()=>[r("App description and what's new notes support markdown")]),_:1}),o(i,{label:"Description"},{default:n(()=>[o(q,{modelValue:e(t).description,"onUpdate:modelValue":s[8]||(s[8]=l=>e(t).description=l),rows:3},null,8,["modelValue"])]),_:1}),o(i,{label:"What's new"},{default:n(()=>[o(q,{modelValue:e(t).whatsnew,"onUpdate:modelValue":s[9]||(s[9]=l=>e(t).whatsnew=l),rows:3},null,8,["modelValue"])]),_:1}),y("div",Te,[o(G,{variant:"primary",loading:e(P)},{default:n(()=>[r(" Save ")]),_:1},8,["loading"]),o(G,{onClick:s[10]||(s[10]=z(l=>{var I;return(I=e(M))==null?void 0:I.show()},["prevent"]))},{default:n(()=>[r(" Fill from another IPA package")]),_:1})])],32)]),o(e(Fe),{id:e(g),ref_key:"copyModal",ref:M,scope:e(k).app_identifier,onSelected:s[11]||(s[11]=l=>C(l,{filterUniqueFields:!0}))},null,8,["id","scope"])],64)}}});export{io as default};
//# sourceMappingURL=BLcD-z6F.js.map
