import{_ as se}from"./Bits-1St.js";import{_ as ne}from"./B5cwp08I.js";import{_ as te}from"./BlxkbhZZ.js";import{_ as ae}from"./Cei0423W.js";import{_ as le}from"./CZ_fOVJB.js";import{_ as ie,c as re}from"./eZfuDZAk.js";import{f as H,r as f,i as L,H as J,o as v,l as N,w as n,d as r,k as e,b as o,c as O,y as K,t as U,a as y,F as T,v as j,s as W,D as ue,g as _e,I as de,h as ce,J as z,m as me,K as pe,G as fe,C as ve,L as ge}from"./eC8h7jmT.js";import{_ as be}from"./BRDNFIE7.js";import{_ as ye}from"./B3aL6DJw.js";import{_ as Q}from"./BGQKDpI7.js";import{u as Ve}from"./BOdbzd-C.js";import{u as he}from"./dlwTujuH.js";import{_ as we}from"./ZtEArWj8.js";import{a as ke,b as xe,c as Se,_ as Pe}from"./2iRVOXPg.js";import{_ as Oe}from"./CBMI6fvo.js";import{b as Ue}from"./K12kXwDF.js";import{c as $e}from"./DCS7RcIW.js";import"./C-C0WP_Z.js";import"./BarbQds6.js";import"./CqO_RI43.js";var V=(_=>(_.iOS="ios",_.iPad="ipados",_.Mac="macos",_.Vision="visionos",_.TV="tvos",_))(V||{});const Ae={[V.Mac]:"Mac",[V.TV]:"Apple TV",[V.Vision]:"Apple Vision",[V.iOS]:"iPhone",[V.iPad]:"iPad"};function Me(_){return Ae[_]}const Ce={class:"flex flex-col gap-1.5"},Fe=H({__name:"v-modal-binary-package-metadata-copy",props:{id:{},scope:{}},emits:["selected"],setup(_,{expose:h,emit:$}){const A=_,B=$,w=f(),g=f(!1);h({show:()=>{var c;return(c=w.value)==null?void 0:c.show()},hide:()=>{var c;return(c=w.value)==null?void 0:c.hide()}});const k=f(!1),t=f([]),M=L(()=>t.value.filter(c=>c.id!==A.id));J(()=>{g.value&&C()});async function C(){k.value=!0;try{t.value=await W({scope:A.scope})}finally{k.value=!1}}function x(c){var u;B("selected",c),(u=w.value)==null||u.hide()}return(c,u)=>{const S=we,m=ke,F=xe,d=Se,P=Q,D=Pe;return v(),N(e(Oe),{ref_key:"modal",ref:w,modelValue:e(g),"onUpdate:modelValue":u[0]||(u[0]=a=>j(g)?g.value=a:null)},{header:n(()=>[r(" Fill metadata from another IPA package ")]),default:n(()=>[e(k)?(v(),N(S,{key:0,class:"border-blue-700/30 border-l-blue-700",size:"4rem"})):(v(),N(D,{key:1},{head:n(()=>[o(F,null,{default:n(()=>[o(m,null,{default:n(()=>[r("Version")]),_:1}),o(m,null,{default:n(()=>[r("Status")]),_:1}),o(m,null,{default:n(()=>[r("Is assigned")]),_:1}),o(m,null,{default:n(()=>[r("Is actual")]),_:1}),o(m)]),_:1})]),empty:n(()=>[r("No IPA packages were found")]),body:n(()=>[(v(!0),O(T,null,K(e(M),a=>(v(),N(F,{key:a.id},{default:n(()=>[o(d,null,{default:n(()=>[r(U(a.bundle_version),1)]),_:2},1024),o(d,null,{default:n(()=>[r(U(a.status_translated),1)]),_:2},1024),o(d,null,{default:n(()=>[r(U(a.is_assigned?"Yes":"No"),1)]),_:2},1024),o(d,null,{default:n(()=>[r(U(a.is_in_store?"Yes":"No"),1)]),_:2},1024),o(d,null,{default:n(()=>[y("div",Ce,[o(P,{variant:"primary",onClick:s=>x(a)},{default:n(()=>[r(" Select ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["modelValue"])}}});var Ie=1,Ne=4;function R(_){return Ue(_,Ie|Ne)}const Le={class:"grid auto-cols-fr grid-flow-col gap-5"},Be={key:0,class:"mt-5 flex h-96 gap-5 overflow-auto"},De=["onClick"],Ee=["src"],Te={class:"flex gap-2"},ro=H({__name:"[id]",async setup(_){let h,$;const{title:A,backPath:B}=Ve("metadata"),w=ue(),g=Number(w.params.id),[k]=([h,$]=_e(()=>W({id:g})),h=await h,$(),h),t=de({id:g,min_ios_version:"",min_ipados_version:"",min_tvos_version:"",min_macos_version:"",min_watchos_version:"",min_visionos_version:"",description:"",whatsnew:"",screenshots_uris_by_os_type:{ios:[],ipados:[],macos:[],tvos:[],universal:[],visionos:[]}}),M=f();function C(a,{filterUniqueFields:s}={}){if(!a)return;const b=["id"];for(const p in t){const i=p;!(i in a)||s&&b.includes(i)||t[i]&&a[i]===null||(t[i]=R(a[i]))}}C(k);const x=L(()=>["universal",...Object.values(V).filter(s=>t[`min_${s}_version`])]),c=L(()=>x.value.map(a=>({label:Me(a)||$e(a),value:a}))),u=f(x.value[0]);J(()=>{x.value.includes(u.value)||(u.value=x.value[0])});const S=f(!1),m=f([]),F=L(()=>m.value.length?m.value.reduce((a,s)=>a+s)/m.value.length:0),d=f([]);ce(d,async()=>{if(!d.value.length)return;const a=u.value;S.value=!0,m.value=Array(d.value.length).fill(0);try{const s=d.value.map((p,i)=>he({type:"screenshot",file:p},{onUploadProgress:E=>{m.value[i]=re(E)}})),b=await Promise.all(s);t.screenshots_uris_by_os_type[a].push(...b)}finally{S.value=!1,m.value=[]}});const P=f(!1);async function D(){P.value=!0;try{const a=R(t);for(const b of Object.values(V))a[`min_${b}_version`]||(a.screenshots_uris_by_os_type[b]=[]);await pe(a),fe("/apps/binary-packages");const{notifySuccess:s}=ve();s("IPA package metadata was saved")}finally{P.value=!1}}return(a,s)=>{var q;const b=se,p=ne,i=te,E=ae,X=le,Z=ie,ee=ge,oe=be,G=ye,Y=Q;return v(),O(T,null,[y("div",null,[o(b,{"default-back-to":e(B)},{default:n(()=>[r(U(e(A)),1)]),_:1},8,["default-back-to"]),y("form",{class:"flex flex-col gap-5",onSubmit:z(D,["prevent"])},[y("div",Le,[o(i,{label:"Min. iOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_ios_version,"onUpdate:modelValue":s[0]||(s[0]=l=>e(t).min_ios_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. iPadOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_ipados_version,"onUpdate:modelValue":s[1]||(s[1]=l=>e(t).min_ipados_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. watchOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_watchos_version,"onUpdate:modelValue":s[2]||(s[2]=l=>e(t).min_watchos_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. macOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_macos_version,"onUpdate:modelValue":s[3]||(s[3]=l=>e(t).min_macos_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. visionOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_visionos_version,"onUpdate:modelValue":s[4]||(s[4]=l=>e(t).min_visionos_version=l)},null,8,["modelValue"])]),_:1}),o(i,{label:"Min. tvOS version"},{default:n(()=>[o(p,{modelValue:e(t).min_tvos_version,"onUpdate:modelValue":s[5]||(s[5]=l=>e(t).min_tvos_version=l)},null,8,["modelValue"])]),_:1})]),y("div",null,[o(E,{class:"mb-3"},{default:n(()=>[r("Screenshots")]),_:1}),o(X,{modelValue:e(u),"onUpdate:modelValue":s[6]||(s[6]=l=>j(u)?u.value=l:null),class:"mb-4",options:e(c)},null,8,["modelValue","options"]),o(Z,{modelValue:e(d),"onUpdate:modelValue":s[7]||(s[7]=l=>j(d)?d.value=l:null),loading:e(S),progress:e(F),extensions:["png"],multiple:"","notification-id":"edit_official_ipa_metadata"},{default:n(()=>[r(" Choose screenshots or drag them here ")]),_:1},8,["modelValue","loading","progress"]),(q=e(t).screenshots_uris_by_os_type[e(u)])!=null&&q.length?(v(),O("div",Be,[(v(!0),O(T,null,K(e(t).screenshots_uris_by_os_type[e(u)],(l,I)=>(v(),O("div",{key:l,class:"relative h-full shrink-0"},[y("button",{class:"absolute right-0 top-0 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 leading-none text-white",onClick:je=>e(t).screenshots_uris_by_os_type[e(u)].splice(I,1)},[o(ee,{name:"tabler:x"})],8,De),y("img",{class:"h-full",src:l},null,8,Ee)]))),128))])):me("",!0)]),o(oe,null,{default:n(()=>[r("App description and what's new notes support markdown")]),_:1}),o(i,{label:"Description"},{default:n(()=>[o(G,{modelValue:e(t).description,"onUpdate:modelValue":s[8]||(s[8]=l=>e(t).description=l),rows:3},null,8,["modelValue"])]),_:1}),o(i,{label:"What's new"},{default:n(()=>[o(G,{modelValue:e(t).whatsnew,"onUpdate:modelValue":s[9]||(s[9]=l=>e(t).whatsnew=l),rows:3},null,8,["modelValue"])]),_:1}),y("div",Te,[o(Y,{variant:"primary",loading:e(P)},{default:n(()=>[r(" Save ")]),_:1},8,["loading"]),o(Y,{onClick:s[10]||(s[10]=z(l=>{var I;return(I=e(M))==null?void 0:I.show()},["prevent"]))},{default:n(()=>[r(" Fill from another IPA package")]),_:1})])],32)]),o(e(Fe),{id:e(g),ref_key:"copyModal",ref:M,scope:e(k).app_identifier,onSelected:s[11]||(s[11]=l=>C(l,{filterUniqueFields:!0}))},null,8,["id","scope"])],64)}}});export{ro as default};
//# sourceMappingURL=MqyeV1Ih.js.map
